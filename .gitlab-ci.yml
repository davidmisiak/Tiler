stages:
  - lint
  - build
  - test

default:
  image: ubuntu:21.04 # we use cryptominisat from Ubuntu's repository
  before_script:
    - apt-get update --yes

lint:
  stage: lint
  script:
    - apt-get install --yes clang-format cppcheck
    - ./scripts/lint.sh
  timeout: 3 minutes

build:
  stage: build
  script:
    - DEBIAN_FRONTEND=noninteractive apt-get install --yes python3-pip cmake libcryptominisat5-dev git make
    - pip install conan
    - conan profile new default --detect
    - conan profile update settings.compiler.libcxx=libstdc++11 default
    - ./scripts/build-cadical.sh
    - ./scripts/setup.sh
    - cmake --build build
  artifacts:
    paths:
      - build
  timeout: 5 minutes

test:
  stage: test
  script:
    - apt-get install --yes cmake libcryptominisat5-dev
    - cd build
    - ctest --verbose
  timeout: 3 minutes
